<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <!-- =========================
       (1) إعدادات أساسية
  ========================== -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>واجهة تقنية</title>

  <!-- =========================
       (2) تهيئة PWA
  ========================== -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#00e6e6" />

  <!-- iOS تحسينات -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <style>
    /* =========================
       (3) ألوان ومتغيرات
    ========================== */
    :root{
      --bg:#121212;
      --cyan:#00e6e6;
      --panel: rgba(0,0,0,.75);
      --panel2: rgba(0,0,0,.55);
      --shadow: 0 0 15px rgba(0,255,255,.45);
      --border: 1px solid rgba(0,230,230,.35);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      height:100vh;
      background: var(--bg);
      color:#fff;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      overflow:hidden;
    }

    /* =========================
       (4) خلفية + Glow
    ========================== */
    .background{
      position:fixed;
      inset:0;
      background: url('https://source.unsplash.com/random/1920x1080?space') no-repeat center center;
      background-size: cover;
      animation: backgroundMove 30s linear infinite;
      filter: blur(3px);
      z-index:-3;
    }
    @keyframes backgroundMove{
      0%{ background-position:center top; }
      100%{ background-position:center bottom; }
    }

    .glow{
      position:fixed;
      inset:0;
      background: radial-gradient(circle, rgba(0,255,255,.22), transparent 60%);
      filter: blur(25px);
      animation: glowAnimation 2s infinite alternate;
      z-index:-2;
      pointer-events:none;
    }
    @keyframes glowAnimation{
      from{ opacity:.45; }
      to{ opacity:.9; }
    }

    /* =========================
       (5) شريط الأخبار RSS
    ========================== */
    #news{
      position:fixed;
      top:0; left:0;
      width:100%;
      display:flex;
      overflow:hidden;
      background:#000;
      border-bottom:2px solid var(--cyan);
      padding: 6px 0;
      z-index:9999;
      box-shadow: 0 0 10px rgba(0,255,255,.5);
    }
    .news-wrapper{
      display:flex;
      align-items:center;
      gap: 30px;
      white-space: nowrap;
      padding-inline: 14px;
      animation: scrollNews 220s linear infinite;
    }
    .news-card{
      max-width: 70vw;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .news-card a{
      text-decoration:none;
      color: var(--cyan);
      font-weight: 800;
      font-size: 15px;
    }
    @keyframes scrollNews{
      0%{ transform: translateX(100%); }
      100%{ transform: translateX(-120%); }
    }

    /* =========================
       (6) هيكل الصفحة العام
    ========================== */
    .container{
      position:relative;
      height:100vh;
      padding-top: 44px;  /* مساحة شريط الأخبار */
      padding-bottom: 74px; /* مساحة شريط الأسفل */
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    /* =========================
       (7) الأيقونات (ثابتة ومتناسقة)
       - الهاتف: Grid مرن
       - الكمبيوتر: ويندوز-like تعبئة عمودي ثم عمود جديد (ثابتة لليسار)
    ========================== */
    .main-buttons{
      width: 100%;
      padding: 14px;
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(88px, 1fr));
      gap: 12px;
      justify-items:center;
      align-content:start;
    }

    /* DESKTOP: ترتيب قريب من سطح ويندوز (أيقونات للـ LEFT دائماً) */
    @media (min-width: 992px){
      .main-buttons{
        display:flex;
        flex-direction:column;
        flex-wrap:wrap;
        align-content:flex-start; /* ثابت لليسار */
        justify-content:flex-start;
        height: calc(100vh - 170px); /* لكي يلف لعمود جديد */
        width: 540px; /* مساحة الأيقونات */
        padding-top: 18px;
        gap: 14px;
      }
    }

    .main-buttons a{ text-decoration:none; }

    .button{
      background: rgba(0,0,0,.7);
      border-radius: 22px;
      width: clamp(72px, 18vw, 92px);
      height: clamp(72px, 18vw, 92px);
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      cursor:pointer;
      transition: transform .2s ease, box-shadow .2s ease, background-color .2s ease;
      box-shadow: var(--shadow);
      user-select:none;
      border: 1px solid rgba(255,255,255,.10);
    }
    .button img{
      width: clamp(48px, 12vw, 70px);
      height: clamp(48px, 12vw, 70px);
      object-fit: contain;
    }
    .button span{
      color: var(--cyan);
      font-size: clamp(11px, 2.6vw, 13px);
      margin-top: -6px;
      font-weight: 900;
      background:#000;
      padding: 2px 8px;
      border-radius: 999px;
    }
    .button:hover{
      transform: scale(1.06);
      box-shadow: 0 0 45px rgba(0,255,255,.75);
      background-color: rgba(0,255,255,.16);
    }
    .button:active{
      transform: scale(1.01);
      background-color: rgba(0,255,255,.28);
    }

    /* =========================
       (8) السلايدر (تأكد أنه لا يخرب الترتيب)
    ========================== */
    .slider-container{
      position: fixed;
      top: 52%;
      left: 0;
      transform: translateY(-50%);
      display:flex;
      align-items:center;
      gap: 16px;
      white-space: nowrap;
      animation: slide 25s linear infinite;
      width: 900px;
      padding-inline: 10px;
      z-index: 5;
      pointer-events:auto;
    }

    /* على الهاتف: خليه تحت الأيقونات قليلاً لتفادي التداخل */
    @media (max-width: 991px){
      .slider-container{
        top: 58%;
        width: 860px;
      }
    }

    .slider-item{
      text-align:center;
      min-width: 190px;
    }
    .slider-item img{
      width: 150px;
      height: 110px;
      border-radius: 12px;
      box-shadow: 0 1px 12px rgba(220,220,225,1);
      transform-origin:center;
      transform: rotateY(15deg);
      animation: rotate 9s ease-in-out infinite alternate;
      cursor:pointer;
    }
    .slider-item h3{
      margin: 4px 0 2px;
      font-size: 15px;
      background: rgba(145,112,35,.55);
      border-radius: 10px;
      padding: 2px 8px;
    }
    .slider-item p{
      margin: 4px 18px;
      font-size: 13px;
      background: rgba(0,0,0,.35);
      border-radius: 10px;
      padding: 2px 8px;
    }

    @keyframes slide{
      from { transform: translate(3%, -50%); }
      to   { transform: translate(-100%, -50%); }
    }
    @keyframes rotate{
      from { transform: rotateY(25deg) scale(1); }
      to   { transform: rotateY(-35deg) scale(1.05); }
    }

    /* =========================
       (9) أزرار سفلية (مدينة/راديو/طوارئ...)
    ========================== */
    .city-buttons{
      width: 100%;
      padding: 0 14px 6px;
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(92px, 1fr));
      gap: 10px;
      justify-items:center;
      z-index: 6;
    }
    .city-button{
      width: 92px;
      height: 78px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      gap: 5px;
      text-decoration:none;
      color: var(--cyan);
      background: rgba(0,0,0,.45);
      border: var(--border);
      border-radius: 999px;
      box-shadow: 0 0 15px rgba(0,255,255,.55);
      transition: transform .2s ease, box-shadow .2s ease, background-color .2s ease;
      user-select:none;
    }
    .city-button img{
      width: 46px;
      height: 46px;
      object-fit: contain;
    }
    .city-button span{
      font-size: 12px;
      font-weight: 900;
      background:#000;
      padding: 2px 8px;
      border-radius: 999px;
    }
    .city-button:hover{
      transform: scale(1.06);
      box-shadow: 0 0 22px rgba(0,255,255,.9);
      background-color: rgba(0,255,55,.18);
    }

    /* =========================
       (10) شريط الأسفل
    ========================== */
    .start-bar{
      position:fixed;
      bottom:0; left:0;
      width:100%;
      padding: 8px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      background: rgba(0,0,0,.82);
      border-top:2px solid var(--cyan);
      box-shadow: 0 0 40px rgba(0,255,255,.45);
      z-index:9998;
    }

    .start-left{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 140px;
    }

    .start-button{
      width: 44px;
      height: 44px;
      border-radius: 999px;
      display:flex;
      justify-content:center;
      align-items:center;
      background: rgba(0,0,0,.72);
      border: 1px solid rgba(255,255,255,.18);
      box-shadow: 0 0 30px rgba(0,255,255,.45);
      cursor:pointer;
      user-select:none;
      transition: transform .2s ease, box-shadow .2s ease;
    }
    .start-button:hover{
      transform: scale(1.05);
      box-shadow: 0 0 45px rgba(0,255,255,.75);
    }
    .start-button img{
      width: 42px;
      height: 42px;
      border-radius: 50%;
      object-fit: cover;
    }

    .icon-buttons{
      display:flex;
      align-items:center;
      gap: 8px;
    }
    .mini{
      width: 38px;
      height: 38px;
      border-radius: 999px;
      display:flex;
      justify-content:center;
      align-items:center;
      background: rgba(0,0,0,.72);
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 0 18px rgba(0,255,255,.38);
      transition: transform .2s ease;
      user-select:none;
    }
    .mini:hover{ transform: scale(1.06); }
    .mini img{
      width: 34px;
      height: 34px;
      object-fit: contain;
      border-radius: 50%;
    }

    .search-bar{
      display:flex;
      align-items:center;
      gap: 6px;
      min-width: 260px;
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(0,230,230,.22);
      border-radius: 14px;
      padding: 7px 9px;
    }
    .search-bar input{
      width: 100%;
      background: transparent;
      border:none;
      outline:none;
      color:#fff;
      font-size: 15px;
    }
    .search-bar button{
      background: var(--cyan);
      border: none;
      padding: 7px 11px;
      border-radius: 12px;
      font-weight: 900;
      cursor:pointer;
      white-space:nowrap;
      transition: opacity .2s ease;
      color:#121212;
    }
    .search-bar button:hover{ opacity:.86; }

    /* زر تثبيت (يظهر فقط عند توفره أو على iOS) */
    .install-btn{
      background: rgba(0,230,230,.18);
      border: 1px solid rgba(0,230,230,.5);
      color: var(--cyan);
      padding: 9px 12px;
      border-radius: 14px;
      cursor: pointer;
      font-weight: 900;
      white-space: nowrap;
      box-shadow: 0 0 18px rgba(0,255,255,.35);
      transition: transform .2s ease, background-color .2s ease;
      user-select:none;
      display:none; /* يتم التحكم به بالـ JS */
    }
    .install-btn:hover{
      transform: scale(1.03);
      background: rgba(0,230,230,.25);
    }

    /* =========================
       (11) قائمة Start Menu
    ========================== */
    .start-menu{
      position:fixed;
      bottom: 68px;
      left: 18px;
      width: min(820px, 92vw);
      display:none;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      padding: 10px;
      border: 1px solid var(--cyan);
      border-radius: 18px;
      background: rgba(0,0,0,.92);
      box-shadow: 0 0 45px rgba(0,255,255,.45);
      z-index:9999;
    }
    .start-menu a{
      text-decoration:none;
      text-align:center;
      color: var(--cyan);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding: 8px 6px;
      border: 1px solid rgba(0,230,230,.55);
      border-radius: 16px;
      background: rgba(0,0,0,.7);
      gap: 6px;
      transition: transform .2s ease, background-color .2s ease, box-shadow .2s ease;
    }
    .start-menu a:hover{
      transform: translateY(-6px);
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 16px rgba(0,230,230,.45);
    }
    .start-menu a img{
      width: 46px;
      height: 46px;
      object-fit: contain;
    }

    /* =========================
       (12) الوقت/التاريخ + حقوق
    ========================== */
    .time-date{
      position:fixed;
      bottom: 76px;
      right: 12px;
      z-index: 9998;
      font-size: 12px;
      color: rgba(255,255,255,.9);
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(0,230,230,.2);
      border-radius: 14px;
      padding: 7px 10px;
      backdrop-filter: blur(4px);
    }

    .credits{
      position:fixed;
      bottom: 76px;
      left: 12px;
      z-index: 9998;
      font-size: 10px;
      color: rgba(255,255,255,.55);
      background: rgba(0,0,0,.22);
      border-radius: 12px;
      padding: 7px 10px;
      max-width: 55vw;
    }

    /* =========================
       (13) نافذة iOS شرح التثبيت فقط
    ========================== */
    .modal-overlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.62);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 10000;
      padding: 16px;
    }
    .modal{
      width: min(560px, 96vw);
      background: rgba(0,0,0,.92);
      border: 1px solid rgba(0,230,230,.45);
      border-radius: 18px;
      box-shadow: 0 0 55px rgba(0,255,255,.35);
      overflow:hidden;
    }
    .modal-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(0,230,230,.2);
    }
    .modal-title{
      font-weight: 1000;
      color: var(--cyan);
      font-size: 16px;
    }
    .modal-close{
      background: transparent;
      border: 1px solid rgba(255,255,255,.25);
      color: #fff;
      border-radius: 12px;
      padding: 6px 10px;
      cursor:pointer;
      font-weight: 800;
    }
    .modal-body{
      padding: 14px;
      line-height: 1.85;
      font-size: 14px;
      color: rgba(255,255,255,.92);
    }
    .hint{
      margin-top: 10px;
      padding: 10px;
      background: rgba(0,230,230,.08);
      border: 1px solid rgba(0,230,230,.18);
      border-radius: 14px;
      font-size: 13px;
    }
  </style>
</head>

<body>
  <div class="background"></div>
  <div class="glow"></div>

  <!-- شريط الأخبار -->
  <section id="news"></section>

  <div class="container">
    <!-- الأيقونات الرئيسية -->
    <div class="main-buttons">
      <a href="pst.html"><div class="button"><img src="https://ia600603.us.archive.org/20/items/512_20241228/512.png" alt=""><span>صانع المنشورات</span></div></a>
      <a href="video.html"><div class="button"><img src="https://cdn3d.iconscout.com/3d/premium/thumb/video-upload-3d-icon-download-in-png-blend-fbx-gltf-file-formats--uploading-pack-user-interface-icons-9325699.png?f=webp" alt=""><span>فيديو تريند</span></div></a>
      <a href="games.html"><div class="button"><img src="https://cdn-icons-png.flaticon.com/512/2331/2331846.png" alt=""><span>ألعاب</span></div></a>
      <a href="research.html"><div class="button"><img src="https://cdn-icons-png.flaticon.com/512/2694/2694971.png" alt=""><span>بحث علمي</span></div></a>
      <a href="student.html"><div class="button"><img src="https://www.freeiconspng.com/download/14040" alt=""><span>مساعد الطالب</span></div></a>
      <a href="chat.html"><div class="button"><img src="https://static.vecteezy.com/system/resources/thumbnails/022/597/448/small/3d-chat-message-notification-icon-png.png" alt=""><span>دردشة عامة</span></div></a>
      <a href="restaurants.html"><div class="button"><img src="https://static.vecteezy.com/system/resources/thumbnails/015/079/413/small_2x/fast-food-restaurant-png.png" alt=""><span>المطاعم</span></div></a>
    </div>

    <!-- سلايدر -->
    <div class="slider-container" id="slider">
      <div class="slider-item">
        <h3>Zakaria Kefo</h3>
        <a href="https://www.youtube.com/@ZakariaKeFo" target="_blank" rel="noopener">
          <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSvXTv84bIkJ7rRuwtpj7o4AXwPM0ah1J6WnQ&s" alt="">
        </a>
        <p>تابع قناتي اليوتيوب</p>
      </div>

      <div class="slider-item">
        <h3>KEFOO GAMING</h3>
        <a href="https://www.youtube.com/@keyfogaming" target="_blank" rel="noopener">
          <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQrnJ8G3RC1PEtbyQspfWiGe22rRU0sNtlLWA&s" alt="">
        </a>
        <p>قناة يوتيوب تحديات وألعاب</p>
      </div>

      <div class="slider-item">
        <h3> </h3>
        <a href="infoadd.html">
          <img src="https://qiyadey.com/wp-content/uploads/2022/02/6D004B6F-4BDA-4B34-A402-723573CA76EE.jpeg" alt="">
        </a>
        <p> </p>
      </div>

      <div class="slider-item">
        <h3> </h3>
        <a href="infoadd.html">
          <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQEMw2XC9tv6nZvO6jWvkUdSD8O3DoDgwhJr744iyLTK4hmaX83lLhSdrLrZT8QbtfHthc&usqp=CAU" alt="">
        </a>
        <p> </p>
      </div>

      <div class="slider-item">
        <h3> </h3>
        <a href="infoadd.html">
          <img src="https://tara-news.com/wp-content/uploads/2020/04/received_235562510966946.jpeg" alt="">
        </a>
        <p> </p>
      </div>
    </div>

    <!-- أزرار سفلية -->
    <div class="city-buttons" id="cityButtons">
      <a href="invite.html" class="city-button"><img src="https://www.freeiconspng.com/thumbs/add-icon-png/user-add-icon---shine-set-add-new-user-add-user-30.png" alt=""><span>دعوة صديق</span></a>
      <a href="city.html" class="city-button"><img src="https://cdn-icons-png.freepik.com/512/3039/3039356.png" alt=""><span>تغيير المدينة</span></a>
      <a href="radio.html" class="city-button"><img src="https://cdn-icons-png.flaticon.com/512/3617/3617100.png" alt=""><span>راديو</span></a>
      <a href="emergency.html" class="city-button"><img src="https://cdn-icons-png.freepik.com/256/655/655958.png?semt=ais_hybrid" alt=""><span>إتصال الطوارئ</span></a>
    </div>
  </div>

  <!-- شريط الأسفل -->
  <div class="start-bar">
    <div class="start-left">
      <div class="start-button" onclick="toggleStartMenu()" title="القائمة">
        <img src="https://ia600604.us.archive.org/26/items/remastered_202501/%D9%A2%D9%A0%D9%A2%D9%A5%D9%A0%D9%A1%D9%A0%D9%A5_%D9%A1%D9%A1%D9%A0%D9%A5%D9%A4%D9%A3_remastered.gif" alt="Start">
      </div>

      <div class="icon-buttons">
        <a class="mini" href="#" onclick="openExternal('https://www.facebook.com/1ZakariaKefo/'); return false;" title="Facebook">
          <img src="https://upload.wikimedia.org/wikipedia/commons/6/6c/Facebook_Logo_2023.png" alt="">
        </a>
        <a class="mini" href="#" onclick="openExternal('https://www.youtube.com/@ZakariaKeFo'); return false;" title="YouTube">
          <img src="https://static-00.iconduck.com/assets.00/youtube-circle-icon-2048x2048-ymi7jg74.png" alt="">
        </a>
      </div>
    </div>

    <!-- زر تثبيت (Android: Prompt فقط | iOS: شرح فقط) -->
    <button class="install-btn" id="installBtn" type="button" onclick="onInstallClick()">تثبيت التطبيق</button>

    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="ابحث هنا...">
      <button type="button" onclick="performSearch()">بحث</button>
    </div>
  </div>

  <!-- Start Menu -->
  <div class="start-menu" id="startMenu">
    <a href="#" onclick="openExternal('https://twitter.com'); return false;">
      <img src="https://cdn3d.iconscout.com/3d/free/thumb/free-twitter-x-3d-icon-download-in-png-blend-fbx-gltf-file-formats--social-media-logo-pack-logos-icons-8263987.png?f=webp" alt="">
      <div>X</div>
    </a>

    <a href="#" onclick="openExternal('tg://'); return false;">
      <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="">
      <div>تيليغرام</div>
    </a>

    <a href="#" onclick="openExternal('https://www.instagram.com'); return false;">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Instagram_icon.png/768px-Instagram_icon.png" alt="">
      <div>إنستغرام</div>
    </a>

    <a href="#" onclick="openExternal('tel:0'); return false;">
      <img src="https://pngimg.com/uploads/phone/phone_PNG49006.png" alt="">
      <div>إتصال</div>
    </a>

    <a href="#" onclick="openExternal('geo:36.2021,37.1343?q=Aleppo'); return false;">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/39/Google_Maps_icon_%282015-2020%29.svg/1024px-Google_Maps_icon_%282015-2020%29.svg.png" alt="">
      <div>الخرائط</div>
    </a>
  </div>

  <!-- وقت/تاريخ -->
  <div class="time-date">
    <div id="time"></div>
    <div id="date"></div>
  </div>

  <!-- حقوق -->
  <div class="credits">برمجة وتطوير زكريا كيفو / جميع الحقوق محفوظة</div>

  <!-- أصوات -->
  <audio id="backgroundMusic" src="https://www.chosic.com/wp-content/uploads/2024/01/Cicadas-chosic.com_.mp3" autoplay loop></audio>
  <audio id="clickSound" src="https://www.myinstants.com/media/sounds/switch-sound.mp3"></audio>

  <!-- نافذة شرح iOS فقط -->
  <div class="modal-overlay" id="iosInstallModal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="iosInstallTitle">
      <div class="modal-header">
        <div class="modal-title" id="iosInstallTitle">تثبيت التطبيق على iPhone / iPad</div>
        <button class="modal-close" type="button" onclick="closeIOSModal()">إغلاق</button>
      </div>
      <div class="modal-body">
        <div><b>الطريقة الصحيحة (Safari):</b></div>
        <ol>
          <li>افتح الموقع من متصفح <b>Safari</b>.</li>
          <li>اضغط زر <b>المشاركة</b> (Share).</li>
          <li>اختر <b>إضافة إلى الشاشة الرئيسية</b> (Add to Home Screen).</li>
          <li>اضغط <b>إضافة</b>.</li>
        </ol>
        <div class="hint">ملاحظة: iOS لا يعرض نافذة تثبيت مثل Android، لذلك التثبيت يتم يدوياً.</div>
      </div>
    </div>
  </div>

  <script>
    /* =========================================================
       1) سلايدر: ترتيب عشوائي + تكرار عناصر
    ========================================================= */
    const slider = document.getElementById('slider');

    function shuffleItems() {
      const items = Array.from(slider.children);
      const shuffled = items
        .map(item => ({ item, sort: Math.random() }))
        .sort((a, b) => a.sort - b.sort)
        .map(({ item }) => item);

      slider.innerHTML = '';
      shuffled.forEach(item => slider.appendChild(item));
    }

    function duplicateItems() {
      const items = Array.from(slider.children);
      items.forEach(item => slider.appendChild(item.cloneNode(true)));
    }

    shuffleItems();
    duplicateItems();

    /* =========================================================
       2) RSS أخبار
    ========================================================= */
    async function fetchRSS() {
      const proxyUrl = 'https://api.allorigins.win/raw?url=';
      const url = 'https://www.syria.tv/rss';

      try {
        const response = await fetch(proxyUrl + encodeURIComponent(url));
        const xml = await response.text();
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xml, "application/xml");

        const items = xmlDoc.querySelectorAll("item");
        const newsContainer = document.getElementById('news');

        const wrapper = document.createElement('div');
        wrapper.classList.add('news-wrapper');

        items.forEach(item => {
          const title = item.querySelector("title")?.textContent?.trim() || "خبر";
          const link  = item.querySelector("link")?.textContent?.trim() || "#";

          const card = document.createElement('div');
          card.classList.add('news-card');
          card.innerHTML = `<a href="${link}" target="_blank" rel="noopener">${title}</a>`;
          wrapper.appendChild(card);
        });

        newsContainer.innerHTML = '';
        newsContainer.appendChild(wrapper);
      } catch (e) {
        console.error('خطأ في جلب الأخبار:', e);
      }
    }
    fetchRSS();
    setInterval(fetchRSS, 120000);

    /* =========================================================
       3) تغيير الخلفية (يمكنك إضافة المزيد لاحقاً)
    ========================================================= */
    function changeBackground() {
      const backgrounds = [
        'https://ia800808.us.archive.org/14/items/0afa-39422cdd-0dc-2a-5c-28d-902279c-89a/0afa39422cdd0dc2a5c28d902279c89a.png'
      ];
      const randomBg = backgrounds[Math.floor(Math.random() * backgrounds.length)];
      document.querySelector('.background').style.backgroundImage = `url(${randomBg})`;
    }
    setInterval(changeBackground, 5000);
    changeBackground();

    /* =========================================================
       4) Start Menu
    ========================================================= */
    function toggleStartMenu(){
      const menu = document.getElementById('startMenu');
      menu.style.display = (menu.style.display === 'grid') ? 'none' : 'grid';
    }

    /* =========================================================
       5) وقت/تاريخ
    ========================================================= */
    function updateTimeAndDate(){
      const now = new Date();
      document.getElementById('time').textContent =
        now.toLocaleTimeString('ar-EG', { hour:'2-digit', minute:'2-digit', second:'2-digit' });
      document.getElementById('date').textContent =
        now.toLocaleDateString('ar-EG', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
    }
    setInterval(updateTimeAndDate, 1000);
    updateTimeAndDate();

    /* =========================================================
       6) أصوات النقر
    ========================================================= */
    const clickSound = document.getElementById('clickSound');
    document.querySelectorAll('.button, .city-button, .mini, .start-button').forEach(btn => {
      btn.addEventListener('click', () => {
        try{
          clickSound.currentTime = 0;
          clickSound.play();
        }catch(e){}
      });
    });

    /* =========================================================
       7) البحث
    ========================================================= */
    function performSearch(){
      const q = document.getElementById('searchInput').value.trim();
      if(q) window.open(`https://www.google.com/search?q=${encodeURIComponent(q)}`, '_blank');
    }

    /* =========================================================
       8) فتح روابط خارجية (حل مشكلة PWA)
    ========================================================= */
    function openExternal(url){
      // tel / geo / schemes
      if (url.startsWith('tel:') || url.startsWith('geo:') || url.includes('://') && !url.startsWith('http')) {
        window.location.href = url;
        return;
      }
      // http/https
      window.open(url, '_blank', 'noopener,noreferrer');
    }

    /* =========================================================
   9) Service Worker (PWA) — تحديث فوري
========================================================= */
if ("serviceWorker" in navigator) {
  window.addEventListener("load", async () => {
    try {
      const reg = await navigator.serviceWorker.register("./sw.js");

      // عند وصول SW جديد (تحديث)
      reg.addEventListener("updatefound", () => {
        const newWorker = reg.installing;
        if (!newWorker) return;

        newWorker.addEventListener("statechange", () => {
          // إذا أصبح مثبتاً ويوجد SW قديم كان مسيطراً -> تحديث جاهز
          if (newWorker.state === "installed" && navigator.serviceWorker.controller) {
            // اطلب منه التفعيل فوراً (يقابل skipWaiting)
            newWorker.postMessage({ type: "SKIP_WAITING" });
          }
        });
      });

      // عند سيطرة SW الجديد: أعد تحميل الصفحة مرة واحدة فقط
      let refreshed = false;
      navigator.serviceWorker.addEventListener("controllerchange", () => {
        if (refreshed) return;
        refreshed = true;
        window.location.reload();
      });

    } catch (e) {
      console.warn("SW register failed:", e);
    }
  });
}
    /* =========================================================
       10) تثبيت التطبيق:
       - Android: Prompt رسمي فقط عند الضغط
       - iOS: نافذة شرح فقط
       - إخفاء الزر بعد التثبيت أو في standalone
    ========================================================= */
    let deferredPrompt = null;

    function isIOS(){
      return /iphone|ipad|ipod/i.test(navigator.userAgent);
    }
    function isInStandaloneMode(){
      return (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) || navigator.standalone === true;
    }

    function syncInstallButton(){
      const btn = document.getElementById('installBtn');
      if (!btn) return;

      // إذا التطبيق مثبت/standalone -> اخفِ الزر
      if (isInStandaloneMode()){
        btn.style.display = 'none';
        return;
      }

      // iOS: اعرض الزر دائماً (لإظهار الشرح)
      if (isIOS()){
        btn.style.display = 'inline-block';
        return;
      }

      // Android/غير iOS: اعرض الزر فقط إذا beforeinstallprompt متاح
      btn.style.display = deferredPrompt ? 'inline-block' : 'none';
    }

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      syncInstallButton();
    });

    window.addEventListener('appinstalled', () => {
      deferredPrompt = null;
      syncInstallButton();
    });

    window.addEventListener('load', syncInstallButton);

    async function onInstallClick(){
      // إذا التطبيق مثبت أساساً
      if (isInStandaloneMode()){
        syncInstallButton();
        return;
      }

      // iOS: شرح فقط
      if (isIOS()){
        openIOSModal();
        return;
      }

      // Android: Prompt رسمي مباشرة
      if (deferredPrompt){
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
        syncInstallButton();
      }
    }

    function openIOSModal(){
      document.getElementById('iosInstallModal').style.display = 'flex';
    }
    function closeIOSModal(){
      document.getElementById('iosInstallModal').style.display = 'none';
    }
  </script>
</body>
</html>
